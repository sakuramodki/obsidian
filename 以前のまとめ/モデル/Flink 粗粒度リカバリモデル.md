---
tags: モデル, Flink, 耐障害性, リカバリ戦略, 分散システム
aliases: Flink All-or-nothing Recovery, Flink Coarse-grained Recovery, 全か無かのリカバリ
---

# モデル/Flink 粗粒度リカバリモデル

## 概要
Flink 粗粒度リカバリモデル（All-or-nothing Recovery）は、Apache Flinkにおける従来の標準的な障害回復戦略です。このモデルでは、ジョブ実行中にいずれか一つのタスク（サブタスクインスタンス）で障害が発生した場合、ジョブ全体のすべてのタスクを停止し、最後の成功したグローバルチェックポイントから全タスクを再起動して状態を復元します。

## どのような側面に着目し、どのような状態を捉えようとしているか
このモデルは、ジョブ全体の**一貫性維持の容易さ**と**実装のシンプルさ**という側面に着目しています。障害発生時の状態を、ジョブ全体が一つの単位として「最後の整合性が取れた状態（チェックポイント）」に戻るか、完全に失敗するかの二択で捉えようとします。つまり、回復の単位は**ジョブ全体**であり、個々のタスクやその一部だけを回復させるという考え方はしません。

このモデルは、「全タスクが正常に動作している状態」と「全タスクが最後のチェックポイントから再開する状態」という対比で、障害からの回復プロセスを捉える枠組みを提供します。

## このモデル/理論が有効となるコンテキスト
* **ストリーミング処理:** 継続的にデータが流れ、タスク間の依存関係が密である場合、一部のタスクだけを再起動しても全体の整合性を保つのが複雑になる可能性があるため、全体を再起動する方がシンプルで確実な場合が多い。
* **ジョブの規模が比較的小さい場合:** 全タスクの再起動コストが許容範囲内である場合。
* **実装の単純さが優先される場合:** より複雑なリカバリロジックを導入することによる開発・運用コストを避けたい場合。
* FLIP-1以前のFlinkにおける標準的なリカバリ方式。

## このモデルの示す事
* 単一のタスク障害がジョブ全体の停止と再起動を引き起こすことを示します（障害の影響が全体に波及）。
* ジョブの規模や並列度が大きい場合、単一の過渡的な障害（例: 一時的なネットワーク断）であっても、リカバリに要する時間と計算リソースが非常に大きくなる可能性があることを示唆します。これは特に完了までに時間がかかるバッチジョブにおいて顕著な問題となりえます（[[FLIP-1 Fine Grained Recovery from Task Failures]]での指摘）。
* 状態の一貫性をグローバルチェックポイントを通じて保証するシンプルなメカニズムを提供します。
* このモデルの非効率性が、[[Flink 細粒度リカバリモデル]]の提案動機となりました。