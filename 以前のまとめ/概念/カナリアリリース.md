---
tags: メソッド, プラットフォームマネジメント, リリース管理, DevOps
aliases: Canary Release, Canary Deployment
---

# 概要(内包)

新しいバージョンのソフトウェアを、まず一部のユーザー（カナリア）にのみ公開し、問題がないことを確認しながら段階的に全ユーザーへと展開していくリリース手法。炭鉱のカナリア（危険を早期に察知するために使われた）に由来する。[[プラットフォームマネジメント]]において、[[フェイルファスト]]を支援し、リリースリスクを低減するための技術の一つ。[[フィーチャートグル]]などを利用して実現されることが多い。

# この概念が適用されるコンテキスト

- 本番環境へのソフトウェアリリース。
- 新機能や大きな変更を伴うリリースのリスクを最小限に抑えたい場合。
- ダウンタイムなしでリリースを行いたい場合。
- [[オブザーバビリティ]]が確保されており、リリース後の影響を監視できる環境。

# メソッド

## 目的

- 新しいバージョンのソフトウェアを本番環境に導入する際のリスク（バグ、パフォーマンス低下など）を低減する。
- 問題が発生した場合の影響範囲を限定し、迅速なロールバックを可能にする。
- 実環境でのユーザー影響を観察しながら、リリースの是非を判断する。

## 手順/要素

1.  **初期リリース**: 新しいバージョンのインフラを準備し、ごく一部のユーザー（例: 1%, 特定リージョン、内部ユーザー）からのトラフィックを新しいバージョンに振り向ける。既存バージョンも並行稼働させる。
2.  **監視**: 新しいバージョンを公開したユーザー群のシステムメトリクス（エラー率、レイテンシなど）やビジネスKPIを注意深く監視する。[[オブザーバビリティ]]が重要。
3.  **評価**: 監視結果に基づき、新しいバージョンに問題がないか評価する。問題があれば、トラフィックを既存バージョンに戻し（ロールバック）、問題を修正する。
4.  **段階的拡大**: 問題がないと判断された場合、新しいバージョンに振り向けるトラフィックの割合を徐々に増やしていく（例: 1% → 10% → 50% → 100%）。各段階で監視と評価を繰り返す。
5.  **完全移行**: 全てのトラフィックが新しいバージョンに移行し、安定稼働が確認されたら、古いバージョンのインフラを停止する。

# 例(外延)

- ロードバランサーの設定を変更し、トラフィックの一部を新バージョンサーバー群に流す。
- [[フィーチャートグル]]を利用し、特定のユーザーセグメントにのみ新機能を有効化する。
- Kubernetesなどのコンテナオーケストレーションツールが提供するCanary Deployment機能を利用する。
