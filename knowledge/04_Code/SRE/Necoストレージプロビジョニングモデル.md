# Necoストレージプロビジョニングモデル (Neco Storage Provisioning Model)

## モデル概要
Necoクラウド基盤におけるKubernetes上での多様なストレージ（TopoLVM、Rook/Ceph RBD、Rook/Ceph RGW）の提供と利用に関する技術的実装および運用手順を説明するモデル。

## モデル適用条件
Kubernetes環境で、異なるIO性能、冗長性、スケーラビリティ要件を持つアプリケーションに対してストレージを提供するケース。

## モデル構造
- **Kubernetes上のストレージ:** PV, PVC, CSI, CSI driverの基本概念。
- **Necoが提供するストレージ:**
    - **TopoLVM:** ノードローカルなNVMe SSDをLVMで管理し、高速IOを提供するCSI driver。MySQLやElasticsearchなど、アプリケーション自身が冗長性を持つミドルウェア向け。
    - **Rook/Ceph:** 分散ストレージCephをKubernetes上で管理・運用するためのRook。
        - **RBD (RADOS Block Device):** 高可用なブロックストレージ。ファイルシステムを構築して利用。NVMe SSD上に構築することでIO性能を緩和。
        - **RGW (RADOS GateWay):** Amazon S3 API互換のオブジェクトストレージ。ログデータやバックアップデータ、添付ファイルなどの保存に利用。HDD上に構築しコストを抑制。

## モデル法則
- アプリケーションのストレージ要件（IO性能、冗長性、スケーラビリティ）に応じて、最適なストレージタイプを選択し提供することで、クラウド基盤の効率的かつ高可用な運用を実現する。
- KubernetesのCSIやCRDを活用することで、多様なストレージバックエンドを共通のインターフェースで抽象化し、利用者に透過的なストレージプロビジョニングを提供する。

## 実装ガイドライン
- 高速IOとアプリケーションレベルでの冗長性確保が可能なワークロードにはTopoLVMを使用する。
- 高可用性とスケーラビリティが求められ、アプリケーションレベルでの冗長性確保が難しいワークロードにはRook/Ceph RBDを使用する。
- オブジェクトストレージが必要なワークロードや、大容量かつ低コストでのデータ保存にはRook/Ceph RGWを使用する。
- KubernetesのPV/PVC、CSI、CRDを理解し、適切に利用する。

## モデル限界と注意点
- TopoLVMはノードローカルなため、ノード故障時にはデータが失われる可能性がある。アプリケーション側での冗長化が必須。
- Rook/Cephはネットワーク経由のアクセスとなるため、ローカルディスクと比較してIO性能が劣る場合がある。
- 各ストレージの特性を理解せず不適切な選択をすると、性能問題やデータ損失のリスクがある。

## 関連事例

### 実装事例
- [【連載】Cybozu.comクラウド基盤の全貌 第5回 Neco のストレージ | サイボウズ Officeブログ](https://blog.cybozu.io/entry/2025/07/18/113000)
  - サイボウズのNecoクラウド基盤におけるストレージ提供の具体的な実装と運用について解説。
  - TopoLVMとRook/Cephの導入背景、技術詳細、利用シナリオがモデルと関連。
  - 異なるストレージ要件への対応方法、Kubernetesとの統合、性能とコストのバランスに関する学習ポイント。

### 関連モデル
- [分散システム障害回復モデル](/knowledge/02_Container/SRE/分散システム障害回復モデル.md) - Rook/Cephによる高可用性ストレージが分散システムにおける障害回復に寄与する。
- [SLO駆動型インシデント検知システム](/knowledge/04_Code/SRE/SLO駆動型インシデント検知システム.md) - ストレージの性能や可用性がSLOに影響を与えるため、監視・検知の対象となる。
