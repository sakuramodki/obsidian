---
tags: モデル, Flink, 耐障害性, リカバリ戦略, 分散システム, FLIP-1
aliases: Flink Fine-grained Recovery, Flink Region Recovery
---

# モデル/Flink 細粒度リカバリモデル

## 概要
Flink 細粒度リカバリモデル（Fine-grained Recovery）は、[[FLIP-1 Fine Grained Recovery from Task Failures]]で提案され、Apache Flinkに導入された障害回復戦略です。[[モデル/Flink 粗粒度リカバリモデル]]とは異なり、タスク障害が発生した場合に、ジョブ全体ではなく、障害の影響を受ける範囲を**局所化**し、失敗したタスクとその依存関係にある下流タスクのみを再起動することを目指します。

## どのような側面に着目し、どのような状態を捉えようとしているか
このモデルは、障害発生時の**リカバリコスト（時間、リソース）の最小化**と**ジョブ実行効率の向上**という側面に着目しています。実行グラフを、データ交換の特性（パイプライン型かブロッキング型か）に基づいて**「リージョン(Region)」**と呼ばれる単位に分割し、障害からの回復をこの**リージョン単位**で行うという考え方に基づいています。

このモデルは、ジョブの状態を「全てのリージョンが正常」な状態と、「一部のリージョンのみが失敗し、再起動が必要」な状態という、より細かい粒度で捉えようとします。回復の単位はジョブ全体ではなく、影響を受けたリージョンとなります。

## このモデル/理論が有効となるコンテキスト
* **大規模・高並列度のジョブ:** 全体再起動のコストが非常に大きいジョブ。
* **バッチ処理ジョブ:** 長時間実行されることが多く、途中で一部のタスクが失敗した場合でも、完了済みの処理結果を無駄にせず、効率的にリカバリを進めたい場合。
* **タスクの障害が局所的で過渡的であることが多い環境:** 一時的な問題による失敗でジョブ全体が停止・再起動するのを避けたい場合。
* [[モデル/Flink 粗粒度リカバリモデル]]の非効率性を解決したい場合。

## このモデルの示す事
* タスク障害の影響範囲を、接続されたタスクの「リージョン」内に限定できる可能性を示します。
* 失敗したリージョンのみを再起動し、正常に完了した上流リージョンの処理結果（中間データ）を再利用することで、リカバリに必要な時間とリソースを大幅に削減できる可能性を示唆します。
* リカバリの単位が細かくなることで、リカバリ戦略の実装が[[モデル/Flink 粗粒度リカバリモデル]]よりも複雑になることを示唆します。（関連メソッド: [[メソッド/Flink リージョンベースリカバリ]], [[メソッド/Flink 実行グラフコンポーネント化]], [[メソッド/Flink 結果パーティション管理(細粒度リカバリ)]]）
* 障害の頻度やパターンによっては、細粒度リカバリが必ずしも常に効率的とは限らないため、状況に応じて従来の粗粒度リカバリに切り替える（フォールバック）メカニズムが必要となる可能性を示唆します。（関連メソッド: [[メソッド/Flink フォールバックリカバリ(細粒度)]]）