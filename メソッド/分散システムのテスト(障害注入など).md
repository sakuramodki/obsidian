---
tags: メソッド, SRE, テスト, 分散システム, 信頼性, 障害注入, カオスエンジニアリング
aliases: DiRT, Disaster Recovery Testing, Chaos Engineering
---
# メソッド/分散システムのテスト(障害注入など)

# 概要
複数のコンポーネントがネットワークを介して連携する分散システム特有の複雑性や障害モードに対応し、システムの信頼性と回復力を検証・向上させるためのテスト戦略および技法。特に、予期せぬ障害発生時のシステムの挙動を確認する障害注入テスト（DiRT, Chaos Engineering）を含む。

# 前提となるモデル/理論とコンテキスト
* **モデル/理論**: [[SRE(Site Reliability Engineering)]], 分散システム理論（CAP定理、フォールトトレランスなど）
* **コンテキスト**: マイクロサービスアーキテクチャなど、多数のサービスが相互に依存しあう複雑な分散システムを運用している状況。単一コンポーネントの障害やネットワークの問題がシステム全体に予期せぬ影響を及ぼす可能性がある状況。システムの回復力（レジリエンス）を事前に検証・強化したい状況。

# 具体的な手順・考慮事項
1.  **分散システムのテストの難しさの認識**:
    * **非決定性**: タイミングやネットワーク状態によって挙動が変わることがある。
    * **部分障害**: 一部のコンポーネントのみが故障する状況を考慮する必要がある。
    * **ネットワーク**: 遅延、パケットロス、分断などを考慮する必要がある。
    * **状態管理**: 複数のノード間での状態の一貫性維持が難しい。
2.  **テスト戦略**:
    * **ユニットテスト**: 個々のコンポーネントのロジックを検証。
    * **インテグレーションテスト**: コンポーネント間の連携を検証。依存サービスのモック/スタブ活用。
    * **エンドツーエンド(E2E)テスト**: ユーザー視点でのシナリオ全体を検証。複雑性が高く不安定になりやすい。
    * **負荷テスト**: 高負荷状態でのパフォーマンスやボトルネックを検証。
    * **本番環境でのテスト**:
        * **カナリアリリース**: 少数のユーザー/インスタンスに新バージョンを先行リリースし、影響を確認。
        * **段階的ロールアウト**: 新バージョンの展開範囲を徐々に広げる。
        * **シャドウイング/ダークトラフィック**: 本番トラフィックの一部を新バージョンに流し、結果を比較・検証する（ユーザー影響なし）。
3.  **障害注入テスト (DiRT: Disaster Recovery Testing / Chaos Engineering)**:
    * **目的**: システムが予期せぬ障害（サーバーダウン、ネットワーク遅延/切断、依存サービス障害など）に対して、想定通りに（あるいは許容範囲内で）動作し、回復できるかを検証する。未知の脆弱性や依存関係を発見する。
    * **計画**:
        * **仮説設定**: 「Xという障害が発生した場合、システムはYのように動作するはずだ」という仮説を立てる。
        * **影響範囲の限定**: 本番環境で実施する場合は、影響範囲を最小限に抑える（例: 一部のインスタンス、特定の時間帯）。テスト環境での実施も有効。
        * **測定**: 障害注入中のSLIやシステム挙動を注意深く監視する。
        * **緊急停止計画**: 想定外の重大な影響が出た場合に、テストを即座に停止する手順を用意する。
    * **実施**: ツール（例: Chaos Monkey, Gremlin）や手動で計画的に障害を注入する。
    * **分析**: 監視データと仮説を比較し、システムの挙動、検出メカニズム、自動回復能力などを評価する。問題点を特定し、改善アクションにつなげる。
4.  **テスト文化の醸成**: 継続的なテストと、テストによる失敗からの学習を奨励する文化を作る。